language: cpp
sudo: required
dist: trusty
env:
 - TEST_SUITE=user
 - TEST_SUITE=root
before_install:
 - sudo add-apt-repository 'deb http://archive.ubuntu.com/ubuntu/ wily main universe' -y
 - |
   sudo sh -c '/bin/echo -e "Package: *\nPin: release n=wily\nPin-Priority: 1" > /etc/apt/preferences.d/wily'
 - sudo apt-get update -qq
install:
 - sudo apt-get -qq -y -t wily install libstdc++-5-dev g++
 - sudo ./prepare-release travis-ci
 - sudo apt-get -qq -y -t wily install gettext liblz4-dev python3-apt
 - make
script:
 - make test
 - test "$TEST_SUITE" != "user"  || ./test/integration/run-tests -q
 - sudo adduser --force-badname --system --home /nonexistent --no-create-home --quiet _apt || true
 - test "$TEST_SUITE" != "root"  || sudo ./test/integration/run-tests -q
